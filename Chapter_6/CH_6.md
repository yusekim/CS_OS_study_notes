### 이 장의 목표
- 임계구역 문제를 설명하고 경쟁 조건을 설명한다.
- 메모리 장벽, compare-and-swap 연산 및 원자적 변수를 사용하여 임계구역 문제에 대한 하드웨어 해결책을 설명한다.
- Mutex락, 세마포, 모니터 및 조건 변수를 사용하여 임계구역 문제를 해결하는 방법을 보인다.
- 적은, 중간 및 심한 경쟁 시나리오에서 임계구역 문제를 해결하는 도구를 평가한다.

## 6.1 배경
경쟁 상황(race condition): 동시에 여러 개의 프로세스가 동일한 자료를 접근하여 조작하고, 그 실행 결과가 접근이 발생한 특정 순서에 의존하는 상황.
운영체제의 여러 부분에서 자원을 조작하기 때문에 위와 같은 상황은 빈번하게 발생한다.

## 6.2 임계구역 문제 The Critical-Section Problem
n 개의 프로세스로 구성되어 있는 시스템을 생각해보자, 각 프로세스는 임계구역이라고 부르는 코드 부분을 포함하고 있고, 그 안에서는 적어도 하나 이상의 다른 프로세스와 공유하는 데이터에 접근하고 갱신할 수 있다.
이 시스템의 중요한 특징은 한 프로세스가 자신의 임계구역에서 수행하는 동안에는 다른 프로세스들은 그들의 임계구역에 들어갈 수 없다는 사실이다.
임계구역 문제에 대한 해결안은 다음의 세 가지 요구 조건을 충족해야 한다.
1. 상호 배재(mutual exclusion): 프로세스 p가 자기의 임계구역에서 실행된다면, 다른 프로세스들은 그들 자신의 임계구역에서 실행될 수 없다.
2. 진행(progress): 자기의 임계구역에서 실행되는 프로세스가 없고 그들 자신의 임계구역으로 진입하려고 하는 프로세스들이 있다면, 나머지 구역에서 실행 중이지 않은 프로세스들만 다음에 누가 그 임계구역으로 진입할 수 있는지를 결정하는데 참여할 수 있으며, 이 선택은 무한정 연기될 수 없다.
3. 한정된 대기(bounded waiting): 프로세스가 자기의 임계구역에 진입하려는 요청을 한 후부터 그 요청이 허용될 때까지 다른 프로세스들이 그들 자신의 임계구역에 진입하도록 허용되는 횟수에 한계가 있어야 한다.

## 6.3 Peterson의 해결안 Peterson's Solution
Peterson의 해결안은 두 프로세스가 두 개의 데이터 항목을 공유하도록 하여 해결한다.
```c
int turn;
boolean flag[2]
```
변수 turn은 임계구역으로 진입할 순번을 나타낸다. flag 배열은 프로세스가 임계구역으로 진입할 준비가 되었다는 것을 나타낸다.
임계구역으로 진입하기 위해서는 P(i)는 먼저 flag[i]를 참으로 만들고, turn을 j로 지정한다. 이렇게 함으로써 프로세스 j가 임계구역으로 진입하기를 원한다면 진입 가능하다는 것을 보장한다. 만일 두 프로세스가 동시에 진입하기를 원한다면 turn은 거의 동시에 i와 j로 지정될 것이다. 그러나 둘 중 오직 한 배정만이 지속된다. 다른 배정은 발생하기는 하지만 곧바로 겹처 쓰이게 된다. turn의 궁극적인 값이 둘 중 누가 먼저 임계구역으로 진입할 것인가를 결정한다.

## 6.4 동기화를 위한 하드웨어 지원 Hardware Support for Synchronization

- **메모리 장벽 Memory Barriers**
컴퓨터 아키텍처가 응용 프로그램에게 제공하는 메모리 접근 시 보장되는 사항을 결정한 방식을 메모리 모델이라고 한다. 메모리 모델은 두 가지 범주 중 하나에 속한다.
1. 강한 순서. 한 프로세서의 메모리 변경 결과가 다른 모든 프로세서에 즉시 보임
2. 약한 순서. 한 프로세서의 메모리 변경 결과가 다른 프로세서에 즉시 보이지 않음

	컴퓨터 아키텍처는 메모리의 모든 변경 사항을 다른 모든 프로세서로 전파하는 명령어를 제공하여 다른 프로세서에서 실행 중인 스레드에 메모리 변경 사항이 보이는 것을 보장한다. 이러한 명령어를 메모리 장벽/메모리 펜스라고 한다.
<br>

- **하드웨어 명령어 Hardware Instructions**

## 6.5 Mutex Locks

